SELECT E.EMPRESA,FG.RAZON AS RAZON_SOCIAL,E.SUREDP AS SUC,SU.NOKOSU AS NOMSUC,E.CJREDP AS CAJA,CJ.NOKOCJ AS NOMCAJA,CONVERT(CHAR(10),E.FEEMDP,103) AS FECHA,
CONVERT(CHAR(8), DATEADD(ss, E.HORAGRAB, '19000101'), 114) AS HORA,E.TIDP AS TIPO_PAGO,E.NUDP AS NUM_SIS,
CASE E.TIDP 
	WHEN 'ATB' THEN 'TRANSFERENCIA' WHEN 'DEP' THEN 'DEPOSITO' WHEN 'EFV' THEN 'EFECTIVO' WHEN 'CHV' THEN 'CHEQUE' WHEN 'TJV' THEN 'TARJETA' 
	WHEN 'ncv' THEN 'PAGO C/NOTA DE CREDITO' WHEN 'EFC' THEN 'DEVOLUCION' WHEN 'CRV' THEN 'REGULARIZACION' ELSE '???' END AS NOMBRE_PAGO,
CASE WHEN E.TIDP='EFC' THEN E.VADP*-1 ELSE E.VADP END AS VALOR,
E.VAVUDP AS VUELTO,CASE WHEN E.TIDP='EFC' THEN (E.VADP-E.VAVUDP)*-1 ELSE (E.VADP-E.VAVUDP) END AS TOT_PAGO,
CASE WHEN E.TIDP='EFC' THEN D.VAASDP*-1 ELSE D.VAASDP END AS VALOR_ASIGNADO,
CASE WHEN E.TIDP IN ('ATB','DEP') THEN 
  ( SELECT TABENDP.NOKOENDP + ' ' + TABENDP.KOENDP + ' ' + TABENDP.CTACTE + ' ' + E.NUCUDP  
     FROM TABENDP WHERE E.EMPRESA=TABENDP.EMPRESA AND E.EMDP=TABENDP.KOENDP AND E.CUDP=TABENDP.CTACTE  ) 
END AS NOMBRE_EMISOR______EMISOR_____CTACTE_____NUMPROPIO,
D.TIDOPA AS TIDOC,ED.NUDO AS NUMDOC,ED.VABRDO AS VALDOC
FROM MAEDPCE AS E WITH (NOLOCK) 
INNER JOIN TABSU AS SU ON E.EMPRESA+E.SUREDP=SU.EMPRESA+SU.KOSU 
INNER JOIN CONFIGP AS FG ON E.EMPRESA=FG.EMPRESA 
INNER JOIN TABCJ AS CJ ON E.EMPRESA+E.SUREDP+E.CJREDP=CJ.EMPRESA+CJ.KOSU+CJ.KOCJ 
LEFT JOIN MAEDPCD AS D ON E.IDMAEDPCE=D.IDMAEDPCE 
LEFT JOIN MAEEDO AS ED ON D.IDRST=ED.IDMAEEDO AND D.TIDOPA=ED.TIDO 
WHERE E.TIDP IN ('ATB','DEP','CHV','EFV','TJV','ncv','EFC','CRV') AND 
---REGISTRAR AQUI EL RANGO DE FECHAS - NO BORRAR COMILLAS SIMPLES
E.FEEMDP = CAST(GETDATE() - 1 AS DATE)  

ORDER BY E.EMPRESA,E.SUREDP,E.CJREDP,E.FEEMDP,E.HORAGRAB
