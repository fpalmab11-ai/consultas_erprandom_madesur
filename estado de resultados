SELECT DE.EMPRESA,DE.PERIODO,DE.NUMECOM,CONVERT(CHAR(10),DE.FECHCOM,103) AS 'FECHACOM',DE.GLOSACOM,
(DD.GRANCUE+DD.MAYOR+DD.CUENTA) AS 'CUENTA',CU.NOCUENTA,DD.TCC AS 'TIENE_CC',
CASE WHEN DD.TCC<>'SC' THEN ROUND((DD.DEBE),0) ELSE 0 END AS 'DEBE',
CASE WHEN DD.TCC<>'SC' THEN ROUND((DD.HABER),0) ELSE 0 END AS 'HABER',
DD.GLOSA AS 'GLOSA_CTA',CCOMPRC.PDCC AS 'PORCENT',CCOMPRC.CODCC AS 'COD_CC',
CASE WHEN DD.DEBE>0 THEN ROUND((DD.DEBE*(CCOMPRC.PDCC/100)),0) ELSE 0 END AS DEBE_CC, 
CASE WHEN DD.HABER>0 THEN ROUND((DD.HABER*(CCOMPRC.PDCC/100)),0) ELSE 0 END HABER_CC,
DD.IFRS AS NORMA
FROM CCOMPRD AS DD WITH (NOLOCK) 
INNER JOIN CCOMPRE DE ON DD.IDCOMPRE=DE.IDCOMPRE 
INNER JOIN CCUENTAS AS CU ON (DD.GRANCUE+DD.MAYOR+DD.CUENTA)=(CU.GRANCUE+CU.MAYOR+CU.CUENTA) AND CU.PERIODO='2025' 
LEFT JOIN CCOMPRC  ON DD.IDCOMPRD=CCOMPRC.IDCOMPRD 
WHERE DE.PERIODO='2025' 
AND DD.IFRS<>'T' 
AND DD.GRANCUE>'39' 
AND DE.FECHCOM BETWEEN {d '2025-01-01'} AND  {d '2025-06-30'}
ORDER BY DE.EMPRESA,DE.FECHCOM

